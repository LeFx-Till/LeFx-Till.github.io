<!--
  This one mainly based on https://github.com/taylordigital13/ARjs_Unity
  Fullscreen buttons are just simple png and the video is mpeg-4 baseline-profile with AAC audio.

  The video is placed on the Hiro marker and playback is stopped until the user clicks the play button.
  The same applies to losing and finding the marker again.

  Removed the iOS Message "Set your browser to request the mobile version of this site and reload to enjoy immersive mode."
!-->

<!DOCTYPE html>
<html>
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <!-- we import arjs version without NFT but with marker + location based support -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.0.0/aframe/build/aframe-ar.js"></script>
    <script>
        const amountMarkers = 9;
        var currentMarker = '';
        var currentMarkerID = '';
        var markerFound = 0;
        var markerIDArray = [];
        var videoArray = [];

        AFRAME.registerComponent('button',
            {
                init: function () {

                    //console.log('#######');

                    //var elem = document.documentElement;
                    //var fullbutton = document.querySelector("#fullscreen");
                    //var button = document.querySelector("#mutebutton");
                    var debugButton = document.querySelector('#debugbutton');
                    var sceneEl = document.querySelector('a-scene');
                    //var isPlaying = false;
                    //var markerEl = document.querySelector('a-marker');
                    const marker = this.el;

                    //button.hidden = true;
                    debugButton.hidden = false;

                    //for (var i = 0; i < amountMarkers; i++) {

                    //    // create marker array
                    //    var queryString = '#marker_' + i;
                    //    var newMarker = document.querySelector(queryString);
                    //    console.log('pushing to marker array ', newMarker, '#marker_' + i);
                    //    markerIDArray.push(newMarker.id);

                    //    // create video array
                    //    var newVideo = document.querySelector('#Video_Asset_' + i);
                    //    videoArray.push(newVideo);
                    //}

                    //PauseVideosAll()


                    marker.addEventListener('markerFound', () => {

                        var markerID = String(marker.id).split('_');

                        if (currentMarkerID != markerID[1]) {
                            currentMarkerID = markerID[1];
                            debugButton.innerHTML = 'new ' + markerID[1];

                            var myVideo = document.createElement('video');
                            myVideo.id = 'Video_Asset_' + currentMarkerID;
                            myVideo.src = 'media/Video_000.mp4';
                            myVideo.autoplay = false;
                            myVideo.loop = true;

                            var videoEl = document.createElement('a-video');
                            videoEl.setAttribute('Video_' + currentMarkerID, { src: '#' + myVideo.id, height: '3', width: '1.698', transparent: false, color: '#FFFFFF' });
                            videoEl.object3D.position.set(0, 1.6, 0);
                            videoEl.object3D.rotation.set(0, 0, 0);

                            sceneEl.appendChild(videoEl);
                        }
                        else {
                            debugButton.innerHTML = 'same ' + markerID[1];
                        }


                        //markerFound = 1;

                        //button.hidden = false;
                        //button.innerHTML = "-- PLAY VIDEO --";

                        //currentMarker = marker.id;
                        //console.log('Se Marker Is Found : ', marker.id, currentMarker);
                    });

                    marker.addEventListener('markerLost', () => {
                        debugButton.innerHTML = '_ _ _ _';

                        //document.documentElement.el.remove;
                        //markerFound = 0;

                        //PauseVideosAll();

                        //isPlaying = false;
                        //button.hidden = true;

                        //currentMarker = '';
                        //console.log('Se Marker Is Lost: ', marker.id);
                    });

                    //button.addEventListener("click", function (evt) {
                    //    if (isPlaying) {

                    //        PauseVideosAll();
                    //        isPlaying = false;
                    //        button.innerHTML = "-- PLAY VIDEO --";
                    //        return;
                    //    }

                    //    if (currentMarker != '') {
                    //        var index = markerIDArray.indexOf(currentMarker);

                    //        videoArray[index].muted = false;
                    //        videoArray[index].play();

                    //        console.log('Me Try play ', videoArray[index].id);
                    //        isPlaying = true;
                    //        button.innerHTML = "Pause";
                    //    }
                    //});

                    //fullbutton.addEventListener("click", function (evt) {
                    //    if (fullscreen == 0) {
                    //        if (elem.requestFullscreen) {
                    //            elem.requestFullscreen();
                    //        }
                    //        else if (elem.mozRequestFullScreen) {
                    //            /* Firefox */
                    //            elem.mozRequestFullScreen();
                    //        }
                    //        else if (elem.webkitRequestFullscreen) {
                    //            /* Chrome, Safari and Opera */
                    //            elem.webkitRequestFullscreen();
                    //        }
                    //        else if (elem.msRequestFullscreen) {
                    //            /* IE/Edge */
                    //            elem.msRequestFullscreen();
                    //        }

                    //        fullbutton.setAttribute("src", "vendor/exit_fullscreen.png");
                    //        fullscreen = 1;
                    //    }
                    //    else {
                    //        if (document.exitFullscreen) {
                    //            document.exitFullscreen();
                    //        }
                    //        else if (document.webkitExitFullscreen) {
                    //            document.webkitExitFullscreen();
                    //        }
                    //        else if (document.mozCancelFullScreen) {
                    //            document.mozCancelFullScreen();
                    //        }
                    //        else if (document.msExitFullscreen) {
                    //            document.msExitFullscreen();
                    //        }

                    //        fullbutton.setAttribute("src", "vendor/fullscreen.png");
                    //        fullscreen = 0;
                    //    }
                    //});
                },
                tick: function (totalTime, deltaTime) {
                    var dTime = deltaTime / 1000;
                    if (markerFound == 1) {

                    }
                }
            });

    </script>
</head>
<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>
    <div style='position: absolute; bottom: 10px; right: 30px; width:100%; text-align: center; z-index: 1;'>
        <button id="mutebutton" style='position: absolute; bottom: 10px' hidden>Play</button>
    </div>
    <div style='position: absolute; bottom: 5px; left: 30px; width:100%; text-align: right; z-index: 1;'>
        <input type="image" id="fullscreen" src="vendor/fullscreen.png" style='position: absolute; bottom: 0px; right: 35px;'></input>
    </div>
    <div style='position: absolute; bottom: 10px; right: 180px; width:100%; text-align: center; z-index: 1;'>
        <button id="debugbutton" style='position: absolute; bottom: 10px' hidden>Debug Marker</button>
    </div>
    <a-scene embedded arjs="debugUIEnabled: false; sourceType: webcam" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        <a-entity id="mouseCursor" cursor="rayOrigin: mouse" raycaster="objects: .intersectable; useWorldCoordinates: true;"></a-entity>

        <!--<a-assets>
            <video id="Video_Asset_0" autoplay="false" loop crossorigin="anonymous" src="media/Video_000.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_1" autoplay="false" loop crossorigin="anonymous" src="media/Video_001.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_2" autoplay="false" loop crossorigin="anonymous" src="media/Video_002.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_3" autoplay="false" loop crossorigin="anonymous" src="media/Video_003.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_4" autoplay="false" loop crossorigin="anonymous" src="media/Video_004.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_5" autoplay="false" loop crossorigin="anonymous" src="media/Video_005.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_6" autoplay="false" loop crossorigin="anonymous" src="media/Video_006.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_7" autoplay="false" loop crossorigin="anonymous" src="media/Video_007.mp4" webkit-playsinline playsinline controls muted></video>
            <video id="Video_Asset_8" autoplay="false" loop crossorigin="anonymous" src="media/Video_008.mp4" webkit-playsinline playsinline controls muted></video>
        </a-assets>-->

        <a-marker id="marker_0" type="pattern" url="marker/border_pattern_000.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_1" type="pattern" url="marker/border_pattern_001.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_2" type="pattern" url="marker/border_pattern_002.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_3" type="pattern" url="marker/border_pattern_003.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_4" type="pattern" url="marker/border_pattern_004.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_5" type="pattern" url="marker/border_pattern_005.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_6" type="pattern" url="marker/border_pattern_006.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_7" type="pattern" url="marker/border_pattern_007.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_8" type="pattern" url="marker/border_pattern_008.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_9" type="pattern" url="marker/border_pattern_009.patt" emitevents="true" button class="iOS"></a-marker>

        <a-marker id="marker_10" type="pattern" url="marker/border_polygons_001.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_11" type="pattern" url="marker/border_polygons_002.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_12" type="pattern" url="marker/border_polygons_003.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_13" type="pattern" url="marker/border_polygons_004.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_14" type="pattern" url="marker/border_polygons_005.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_15" type="pattern" url="marker/border_polygons_006.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_16" type="pattern" url="marker/border_polygons_007.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_17" type="pattern" url="marker/border_polygons_008.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_18" type="pattern" url="marker/border_polygons_009.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_19" type="pattern" url="marker/border_polygons_010.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_20" type="pattern" url="marker/border_polygons_011.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_21" type="pattern" url="marker/border_polygons_012.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_22" type="pattern" url="marker/border_polygons_013.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_23" type="pattern" url="marker/border_polygons_014.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_24" type="pattern" url="marker/border_polygons_015.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_25" type="pattern" url="marker/border_polygons_016.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_26" type="pattern" url="marker/border_polygons_017.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_27" type="pattern" url="marker/border_polygons_018.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_28" type="pattern" url="marker/border_polygons_019.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_29" type="pattern" url="marker/border_polygons_020.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_30" type="pattern" url="marker/border_polygons_021.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_31" type="pattern" url="marker/border_polygons_022.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_32" type="pattern" url="marker/border_polygons_023.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_33" type="pattern" url="marker/border_polygons_024.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_34" type="pattern" url="marker/border_polygons_025.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_35" type="pattern" url="marker/border_polygons_026.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_36" type="pattern" url="marker/border_polygons_027.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_37" type="pattern" url="marker/border_polygons_028.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_38" type="pattern" url="marker/border_polygons_029.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_39" type="pattern" url="marker/border_polygons_030.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_40" type="pattern" url="marker/border_polygons_031.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_41" type="pattern" url="marker/border_polygons_032.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_42" type="pattern" url="marker/border_polygons_033.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_43" type="pattern" url="marker/border_polygons_034.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_44" type="pattern" url="marker/border_polygons_035.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_45" type="pattern" url="marker/border_polygons_036.patt" emitevents="true" button class="iOS"></a-marker>
        <a-marker id="marker_46" type="pattern" url="marker/border_polygons_037.patt" emitevents="true" button class="iOS"></a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let iOS = (isIOS = (/iPad|iPhone|iPod/.test(navigator.platform) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) && !window.MSStream) ? 1.5 : 0;
        if (iOS) {
            var incompatible = document.querySelector(".Android");
        } else {
            var incompatible = document.querySelector(".iOS");
        }
        incompatible.remove();
    </script>

</body>
</html>